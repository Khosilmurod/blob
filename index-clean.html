<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blob Simulation</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    
    <script>
        // Simple Blob class that doesn't use p5.js functions in constructor
        class SimpleBlob {
            constructor(x, y, teamId) {
                this.x = x;
                this.y = y;
                this.teamId = teamId;
                this.life = 100;
                this.size = 20;
                this.vx = 0;
                this.vy = 0;
                this.targetX = x;
                this.targetY = y;
            }
            
            update() {
                // Simple movement
                if (random(100) < 2) { // 2% chance to change direction
                    this.targetX = random(width);
                    this.targetY = random(height);
                }
                
                // Move towards target
                let dx = this.targetX - this.x;
                let dy = this.targetY - this.y;
                let dist = sqrt(dx*dx + dy*dy);
                
                if (dist > 1) {
                    this.vx = (dx / dist) * 2;
                    this.vy = (dy / dist) * 2;
                }
                
                this.x += this.vx;
                this.y += this.vy;
                
                // Keep in bounds
                this.x = constrain(this.x, this.size, width - this.size);
                this.y = constrain(this.y, this.size, height - this.size);
                
                // Slow down
                this.vx *= 0.95;
                this.vy *= 0.95;
            }
            
            draw() {
                push();
                translate(this.x, this.y);
                
                // Team colors
                if (this.teamId === 0) {
                    fill(255, 100, 100); // Red team
                } else if (this.teamId === 1) {
                    fill(100, 255, 100); // Green team
                } else {
                    fill(100, 100, 255); // Blue team
                }
                
                stroke(255);
                strokeWeight(2);
                circle(0, 0, this.size);
                
                // Life bar
                fill(255);
                noStroke();
                rect(-10, -15, 20, 3);
                
                if (this.life > 60) fill(0, 255, 0);
                else if (this.life > 30) fill(255, 255, 0);
                else fill(255, 0, 0);
                
                rect(-10, -15, (this.life / 100) * 20, 3);
                
                pop();
            }
            
            isAlive() {
                return this.life > 0;
            }
        }
        
        let blobs = [];
        let frameCounter = 0;
        
        function setup() {
            createCanvas(windowWidth, windowHeight);
            
            // Create initial blobs
            for (let i = 0; i < 30; i++) {
                let teamId = floor(random(3)); // 3 teams
                let x = random(50, width - 50);
                let y = random(50, height - 50);
                blobs.push(new SimpleBlob(x, y, teamId));
            }
            
            console.log("Setup complete! Created", blobs.length, "blobs");
        }
        
        function draw() {
            background(20);
            frameCounter++;
            
            // Update and draw blobs
            for (let blob of blobs) {
                blob.update();
                blob.draw();
            }
            
            // Combat system
            if (frameCounter % 10 === 0) { // Check combat every 10 frames
                for (let i = 0; i < blobs.length; i++) {
                    for (let j = i + 1; j < blobs.length; j++) {
                        let blob1 = blobs[i];
                        let blob2 = blobs[j];
                        
                        if (blob1.teamId !== blob2.teamId) {
                            let dx = blob1.x - blob2.x;
                            let dy = blob1.y - blob2.y;
                            let dist = sqrt(dx*dx + dy*dy);
                            
                            if (dist < 40) { // Combat range
                                // Both take damage
                                blob1.life -= 5;
                                blob2.life -= 5;
                                
                                // Visual effect
                                stroke(255, 255, 0);
                                strokeWeight(3);
                                line(blob1.x, blob1.y, blob2.x, blob2.y);
                            }
                        }
                    }
                }
            }
            
            // Remove dead blobs
            blobs = blobs.filter(blob => blob.isAlive());
            
            // Add new blobs occasionally
            if (frameCounter % 60 === 0 && blobs.length < 100) {
                let teamId = floor(random(3));
                let x = random(50, width - 50);
                let y = random(50, height - 50);
                blobs.push(new SimpleBlob(x, y, teamId));
            }
            
            // UI
            fill(255);
            noStroke();
            textSize(16);
            text(`Blobs: ${blobs.length}`, 20, 30);
            text(`Frame: ${frameCounter}`, 20, 50);
            
            // Team counts
            let teamCounts = [0, 0, 0];
            for (let blob of blobs) {
                teamCounts[blob.teamId]++;
            }
            
            fill(255, 100, 100);
            text(`Red Team: ${teamCounts[0]}`, 20, 80);
            fill(100, 255, 100);
            text(`Green Team: ${teamCounts[1]}`, 20, 100);
            fill(100, 100, 255);
            text(`Blue Team: ${teamCounts[2]}`, 20, 120);
        }
        
        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
        
        function keyPressed() {
            if (key === ' ') {
                // Add random blob
                let teamId = floor(random(3));
                let x = random(50, width - 50);
                let y = random(50, height - 50);
                blobs.push(new SimpleBlob(x, y, teamId));
                console.log("Added blob! Total:", blobs.length);
            }
        }
    </script>
</body>
</html>
